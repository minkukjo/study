<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/study/blog/rss.xml" title="도전하는 개발자 조민국 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/study/blog/atom.xml" title="도전하는 개발자 조민국 Blog Atom Feed"><title data-react-helmet="true">특정 노드에만 파드 배포하기 | 도전하는 개발자 조민국</title><meta data-react-helmet="true" property="og:url" content="https://minkukjo.github.io/study/docs/kubernetes/node-isolation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="특정 노드에만 파드 배포하기 | 도전하는 개발자 조민국"><meta data-react-helmet="true" name="description" content="개요"><meta data-react-helmet="true" property="og:description" content="개요"><link data-react-helmet="true" rel="shortcut icon" href="/study/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://minkukjo.github.io/study/docs/kubernetes/node-isolation"><link data-react-helmet="true" rel="alternate" href="https://minkukjo.github.io/study/docs/kubernetes/node-isolation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://minkukjo.github.io/study/docs/kubernetes/node-isolation" hreflang="x-default"><link rel="stylesheet" href="/study/assets/css/styles.3bc75589.css">
<link rel="preload" href="/study/assets/js/runtime~main.4e116869.js" as="script">
<link rel="preload" href="/study/assets/js/main.e5f2ddab.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/study/"><strong class="navbar__title">Home</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/study/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/study/blog">Blog</a><a class="navbar__item navbar__link" href="/study/portfolio">Portfolio</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/minkukjo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://minkukjo.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/study/"><strong class="navbar__title">Home</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/study/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/study/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/study/portfolio">Portfolio</a></li><li class="menu__list-item"><a href="https://github.com/minkukjo" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://minkukjo.github.io/" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/study/docs/intro">소개</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Kubernetes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">15단계로 배우는 쿠버네티스</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/00-intro">00. 스터디 시작의 계기</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/01-what-is-k8s">01. 쿠버네티스란 무엇인가</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/02-what-is-container">02. 컨테이너란 무엇인가</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/03-kubernetes-architecture">03. 쿠버네티스의 기본</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/04-docker-command">04. 도커 명령어</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/05-docker-deeper">05. 도커 이해하기</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/06-dockerfile">06. 컨테이너 개발</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/07-container-network">07. 컨테이너 네트워크</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/08-container-api">08. 컨테이너 API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/09-kubernetes-first-step">09. 쿠버네티스 첫 걸음</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/10-manifest">10. 매니페스트</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/11-service">11. 서비스</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/12-ingress">12. 인그레스</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/13-deplyoment">13. 디플로이먼트</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/14-statefulset">14. 스테이트풀셋</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/15-autoscale">15. 오토스케일</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/16-ingress-deeper">16. 인그레스 기능</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/17-storage">17. 스토리지</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/18-job">18. Job과 Cron Job</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/study/docs/kubernetes/node-isolation">특정 노드에만 파드 배포하기</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">이펙티브 자바</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/01-intro">01. 소개</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/02-object-create-destroy">02. 객체 생성 파괴</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/03-public-method">03. 모든 객체의 공통 메서드</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/04-class-interface">04. 클래스와 인터페이스</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/05-generic">05. 제네릭</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/06-enum-annotation">06. 이넘 타입과 애너테이션</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/06-enum-annotation">06. 이넘 타입과 애너테이션</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/07-lambda-stream">07. 람다와 스트림</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">특정 노드에만 파드 배포하기</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="개요"></a>개요<a class="hash-link" href="#개요" title="Direct link to heading">#</a></h2><p>이번 시간에는 쿠버네티스의 특정 노드에만 파드를 배포하는 방법에 대해서 알아보겠습니다.</p><p>이를 위해서는 <code>Node-Affinity</code>와 <code>Taints</code>와 <code>Toleration</code>에 대해서 알아야합니다.</p><p><code>Taints</code>는 <code>Node-Affinity</code>와 반대되는 옵션입니다.</p><p><code>Node-Affinity</code>가 <code>Pod가 특정 Node</code>에 배포될 수 있게 하는 옵션이라면,</p><p><code>Taints</code>는 <code>Node가 특정 Pod</code>를 쫓아내는 옵션입니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="node-affinity"></a>Node-Affinity<a class="hash-link" href="#node-affinity" title="Direct link to heading">#</a></h2><img width="1627" alt="스크린샷 2021-02-17 오전 12 16 20" src="https://user-images.githubusercontent.com/43809168/108082421-6cb31800-70b5-11eb-8ee1-2ba1d82617f2.png"><img width="1616" alt="스크린샷 2021-02-17 오전 12 16 28" src="https://user-images.githubusercontent.com/43809168/108082429-6f157200-70b5-11eb-8972-318be36e40f4.png"><p>Node-Affinity에서 주목할 옵션은 아래입니다.</p><p><code>requiredDuringSchedulingIgnoredDuringExecution</code> 인데요.</p><p>막상 보면 길어보이지만 잘라서 보면 이해하기 쉽습니다.</p><p>Node-Affinity의 옵션은 크게 가장 앞 부분인 <code>required</code>와 <code>preferred</code> 조건으로 나누어집니다.</p><p><code>required</code>는 <code>반드시</code> 이 파드가 해당 노드에 배포가 되어야한다는 점이고 <code>preferred</code>는 가급적이면~ 이라는 옵션입니다.</p><p>그리고 꼬리에 해당하는 <code>IgnoredDuringExecution</code>의 경우 런타임에 노드의 Label이 바뀌더라도 무시할 것인지, 즉시 eviction할 것인지에 대한 옵션입니다.</p><p>반대 옵션으로는 <code>RequiredDuringExecution</code>가 있습니다.</p><p>이를 종합해보면,</p><ul><li><p><code>requiredDuringSchedulingIgnoredDuringExecution</code></p></li><li><p><code>preferredDuringSchedulingIgnoredDuringExecution</code></p></li><li><p><code>requiredDuringSchedulingRequiredDuringExecution</code></p></li><li><p><code>preferredDuringSchedulingRequiredDuringExecution</code></p></li></ul><p>총 네 개의 조합이 가능해집니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="node의-입장에서"></a>Node의 입장에서<a class="hash-link" href="#node의-입장에서" title="Direct link to heading">#</a></h2><p><code>Node-Affinity</code>는 <strong>특정 파드</strong>가 <strong>특정 노드</strong>로 배포할 것을 설정하는 옵션입니다.</p><p>그러나 A Pod가 Node01로의 배포를 반드시 보장해주지만,</p><p>Node01에서 B,C 파드가 배포될 것을 보장해주지는 않습니다.</p><img width="1765" alt="스크린샷 2021-02-17 오전 12 16 33" src="https://user-images.githubusercontent.com/43809168/108082437-70df3580-70b5-11eb-831a-d2a171cbc531.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="node-affinity-vs-node-selector"></a>Node-Affinity VS Node-Selector<a class="hash-link" href="#node-affinity-vs-node-selector" title="Direct link to heading">#</a></h2><p>우리는 이전에, Node-Selector를 이용해서도 Node-Affinity와 비슷한 기능을 구현할 수 있는 것을 알고 있습니다.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> A</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">affinity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> k8s.gcr.io/pause</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">nodeName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> node01</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>얼핏 봐서는 이 옵션이 <code>Node-Affinity</code> 보다 더 명확하고 직관적이라는 생각도 듭니다.</p><p>하지만 k8s에서는 이 <code>Node-Selector</code>보다 <code>Node-Affinity</code>를 권장하고 있으며, 추후에 <code>Node-Selector</code>를 Deprecate하고 <code>Node-Affinity</code>만을 사용할 것이라고 밝혔습니다.</p><p>그 이유는 <code>Node-Affinity</code>에서는 조금 더 다양한 표현식으로 선택이 가능하며, 제약조건의 주체가 노드에 있는 것이 아닌 파드에 부여함으로써 서로 같이 배치될 수 있는 파드와 아닌 파드를 정의하는게 가능해지기 때문인데요.</p><p><code>Node-Selector</code>에서는 <code>반드시</code> 해당 노드에 배포가 된다는 식의 설정이지만, <code>Node-Affinity</code>의 경우 <code>가급적이면 그렇게 해줘</code>라는 옵션도 설정이 가능하므로 조금 더 유연하게 사용할 수 있다는 장점도 있습니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="taints와-toleration"></a>Taints와 Toleration<a class="hash-link" href="#taints와-toleration" title="Direct link to heading">#</a></h2><p>그러면 <code>Node-Affinity</code>에 반대되는 옵션인 <code>Taints</code>는 무엇일까요?</p><p><code>Taints</code>의 사전적 의미는 <strong>오염</strong>, <strong>감염</strong>이라는 뜻을 갖고 있는데요.</p><p>노드에 <code>Taints</code>를 하면, <code>Toleration</code>을 가진 <code>Pod</code>만 해당 노드에 배포될 수 있게 하는 옵션입니다.</p><img width="1769" alt="스크린샷 2021-02-17 오전 12 17 43" src="https://user-images.githubusercontent.com/43809168/108082623-a3892e00-70b5-11eb-8a24-42854cc6c8a2.png"><img width="1762" alt="스크린샷 2021-02-17 오전 12 17 48" src="https://user-images.githubusercontent.com/43809168/108082624-a4ba5b00-70b5-11eb-98a1-ae79f889766f.png"><img width="1780" alt="스크린샷 2021-02-17 오전 12 17 53" src="https://user-images.githubusercontent.com/43809168/108082627-a5eb8800-70b5-11eb-8aad-c8f96804fd4c.png"><img width="1761" alt="스크린샷 2021-02-17 오전 12 17 57" src="https://user-images.githubusercontent.com/43809168/108082631-a6841e80-70b5-11eb-93bd-9c359171d51a.png"><img width="1826" alt="스크린샷 2021-02-17 오전 12 18 04" src="https://user-images.githubusercontent.com/43809168/108082636-a7b54b80-70b5-11eb-9452-94571345164e.png"><p>노드에 <code>Taints</code>를 추가하는 명령어는 다음과 같습니다.</p><p><code>kubectl taints node 노드_이름 key=value:effect</code></p><p>여기서 key와 value는 임의로 줄 수 있으나 <code>effect</code>는 정해진 것을 사용해야합니다.</p><p>노드에 추가된 <code>Taints</code>를 제거하는 명령은 다음과 같습니다.</p><p><code>kubectl taints node 노드_이름 key=value:effect-</code></p><p>Taints <code>effect</code>에는 <code>NoSchedule</code>, <code>NoExecute</code>, <code>PreferNoSchedule</code> 세 가지 <code>effect</code>가 존재합니다.</p><p><code>NoSchedule</code>은 일치하는 <code>Toleration</code>이 없으면 해당 노드에 파드를 배치할 수 없음을 의미합니다.</p><p><code>PreferNoSchedule</code>은 toleration이 없으면 포드를 스케쥴링 하지 않으려고 하지만, 이는 필수는 아닙니다. 클러스터 내의 자원이 부족하다면 taint가 있는 노드에도 파드가 스케쥴 될 수 있습니다.</p><p><code>NoExecute</code>의 경우 새롭게 생성된 파드가 toleration이 없으면 배치되지 않게 하고, 기존에 존재하던 파드도 taint에 맞는 toleration이 없다면 즉시 종료시킵니다.</p><p>Node01에 다음과 같이 taints를 주고, A Pod에 Toleration을 부여해보겠습니다.</p><p><code>kubectl taints node node01 color=white:NoSchedule</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> A</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">affinity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> k8s.gcr.io/pause</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">tolerations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;color&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Equal&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;white&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">effect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;NoSchedule&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>참고로 <code>operator</code>의 경우 <code>Equal</code> 외에도 <code>Exists</code>도 사용가능합니다만, 이 경우 <code>value</code>를 따로 명시하지않아야 합니다.</p><p>만약 다음과 같이 <code>effect</code>가 <code>NoExecute</code>인 경우 특정 시간 이후에 노드 내에 있는 Toleration의 파드들을 제거하고 싶다면 다음과 같은 옵션을 줄 수도 있습니다.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> A</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">affinity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> k8s.gcr.io/pause</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">tolerations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;color&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Equal&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;white&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">effect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;NoExecute&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">tolerationSeconds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3600</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>이렇게 하면 5분 뒤에 노드 내에 Toleration이 없는 파드들은 모두 제거될 것입니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pod의-입장에서"></a>Pod의 입장에서<a class="hash-link" href="#pod의-입장에서" title="Direct link to heading">#</a></h2><img width="1808" alt="스크린샷 2021-02-17 오전 12 18 10" src="https://user-images.githubusercontent.com/43809168/108082639-a84de200-70b5-11eb-9983-a34f366b120f.png"><p>그러나 특정 노드의 <code>Taints</code>의 <code>Toleration</code>을 가진 파드가 반드시 해당 노드에 배포되는 것은 아닙니다.</p><p>해당 파드는 얼마든지 다른 노드로도 배포될 수 있습니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="node-affinity--taints-and-toleration"></a>Node-Affinity + Taints And Toleration<a class="hash-link" href="#node-affinity--taints-and-toleration" title="Direct link to heading">#</a></h2><p>그렇다면 앞서 배운 <code>Node-Affinity</code>와 <code>Taints And Toleration</code>를 모두 사용해보겠습니다.</p><p><code>kubectl taints node node01 color=white:NoSchedule</code></p><img width="1766" alt="스크린샷 2021-02-17 오전 12 20 15" src="https://user-images.githubusercontent.com/43809168/108082951-ee0aaa80-70b5-11eb-96fc-55e2dc1ed3cb.png"><p>두 기능을 조합하면 특정 파드가 반드시 특정 노드에 배포되는 것을,</p><p>특정 노드는 반드시 특정 파드만 배포되게 허락하는 것을 설정할 수 있습니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="한-줄-요약"></a>한 줄 요약<a class="hash-link" href="#한-줄-요약" title="Direct link to heading">#</a></h2><p><code>Node-Affinity + Taints And Toleration</code>를 사용하면 특정 노드와 특정 파드가 서로 반드시 배치하고 배치되어지는 것을 보장할 수 있다.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/minkukjo/study/edit/master/docs/kubernetes/node-isolation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-05-29T03:52:54.000Z" class="lastUpdatedDate_1WI_">5/29/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/study/docs/kubernetes/15steps/18-job"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 18. Job과 Cron Job</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/study/docs/java/effective-java/01-intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">01. 소개 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#개요" class="table-of-contents__link">개요</a></li><li><a href="#node-affinity" class="table-of-contents__link">Node-Affinity</a></li><li><a href="#node의-입장에서" class="table-of-contents__link">Node의 입장에서</a></li><li><a href="#node-affinity-vs-node-selector" class="table-of-contents__link">Node-Affinity VS Node-Selector</a></li><li><a href="#taints와-toleration" class="table-of-contents__link">Taints와 Toleration</a></li><li><a href="#pod의-입장에서" class="table-of-contents__link">Pod의 입장에서</a></li><li><a href="#node-affinity--taints-and-toleration" class="table-of-contents__link">Node-Affinity + Taints And Toleration</a></li><li><a href="#한-줄-요약" class="table-of-contents__link">한 줄 요약</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Harry's Study, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/study/assets/js/runtime~main.4e116869.js"></script>
<script src="/study/assets/js/main.e5f2ddab.js"></script>
</body>
</html>