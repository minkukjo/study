<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/study/blog/rss.xml" title="ë„ì „í•˜ëŠ” ê°œë°œì Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/study/blog/atom.xml" title="ë„ì „í•˜ëŠ” ê°œë°œì Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="ë„ì „í•˜ëŠ” ê°œë°œì" href="/study/opensearch.xml"><title data-react-helmet="true">Spring Security OAuth2 Login | ë„ì „í•˜ëŠ” ê°œë°œì</title><meta data-react-helmet="true" property="og:url" content="https://minkukjo.github.io/study/docs/spring/security/spring-security-flow"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Spring Security OAuth2 Login | ë„ì „í•˜ëŠ” ê°œë°œì"><meta data-react-helmet="true" name="description" content="Spring Security OAuth2 Client ê·¸ ê¹Šì€ ì„¸ê³„ë¡œ"><meta data-react-helmet="true" property="og:description" content="Spring Security OAuth2 Client ê·¸ ê¹Šì€ ì„¸ê³„ë¡œ"><link data-react-helmet="true" rel="shortcut icon" href="/study/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://minkukjo.github.io/study/docs/spring/security/spring-security-flow"><link data-react-helmet="true" rel="alternate" href="https://minkukjo.github.io/study/docs/spring/security/spring-security-flow" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://minkukjo.github.io/study/docs/spring/security/spring-security-flow" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://R6WS6DHCQH-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/study/assets/css/styles.2d555e26.css">
<link rel="preload" href="/study/assets/js/runtime~main.6e54e51d.js" as="script">
<link rel="preload" href="/study/assets/js/main.b6c5c469.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/study/"><strong class="navbar__title">Home</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/study/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/study/blog">Blog</a><a class="navbar__item navbar__link" href="/study/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/minkukjo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://minkukjo.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/study/"><strong class="navbar__title">Home</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/study/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/study/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/study/about">About</a></li><li class="menu__list-item"><a href="https://github.com/minkukjo" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://minkukjo.github.io/" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/study/docs/intro">ì†Œê°œ</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Spring</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">JPA</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/spring/jpa/kotlin-jpa-guide">Kotlin JPA ê°œë°œ ê°€ì´ë“œ</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Security</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/study/docs/spring/security/spring-security-flow">Spring Security OAuth2 Login</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Code</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ë¦¬íŒ©í† ë§</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/code/refactoring/00-intro">00. ìŠ¤í„°ë”” ì‹œì‘</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/code/refactoring/01-first">01. ì²« ë²ˆì§¸ ì˜ˆì‹œ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/code/refactoring/02-principle">02. ë¦¬íŒ©í† ë§ ì›ì¹™</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/code/refactoring/03-smell">03. ì½”ë“œì—ì„œ ë‚˜ëŠ” ì•…ì·¨</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Kubernetes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">15ë‹¨ê³„ë¡œ ë°°ìš°ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/00-intro">00. ìŠ¤í„°ë”” ì‹œì‘ì˜ ê³„ê¸°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/01-what-is-k8s">01. ì¿ ë²„ë„¤í‹°ìŠ¤ë€ ë¬´ì—‡ì¸ê°€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/02-what-is-container">02. ì»¨í…Œì´ë„ˆë€ ë¬´ì—‡ì¸ê°€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/03-kubernetes-architecture">03. ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê¸°ë³¸</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/04-docker-command">04. ë„ì»¤ ëª…ë ¹ì–´</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/05-docker-deeper">05. ë„ì»¤ ì´í•´í•˜ê¸°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/06-dockerfile">06. ì»¨í…Œì´ë„ˆ ê°œë°œ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/07-container-network">07. ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/08-container-api">08. ì»¨í…Œì´ë„ˆ API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/09-kubernetes-first-step">09. ì¿ ë²„ë„¤í‹°ìŠ¤ ì²« ê±¸ìŒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/10-manifest">10. ë§¤ë‹ˆí˜ìŠ¤íŠ¸</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/11-service">11. ì„œë¹„ìŠ¤</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/12-ingress">12. ì¸ê·¸ë ˆìŠ¤</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/13-deplyoment">13. ë””í”Œë¡œì´ë¨¼íŠ¸</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/14-statefulset">14. ìŠ¤í…Œì´íŠ¸í’€ì…‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/15-autoscale">15. ì˜¤í† ìŠ¤ì¼€ì¼</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/16-ingress-deeper">16. ì¸ê·¸ë ˆìŠ¤ ê¸°ëŠ¥</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/17-storage">17. ìŠ¤í† ë¦¬ì§€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/15steps/18-job">18. Jobê³¼ Cron Job</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kubernetes/node-isolation">íŠ¹ì • ë…¸ë“œì—ë§Œ íŒŒë“œ ë°°í¬í•˜ê¸°</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ì´í™í‹°ë¸Œ ìë°”</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/01-intro">01. ì†Œê°œ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/02-object-create-destroy">02. ê°ì²´ ìƒì„± íŒŒê´´</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/03-public-method">03. ëª¨ë“  ê°ì²´ì˜ ê³µí†µ ë©”ì„œë“œ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/04-class-interface">04. í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/05-generic">05. ì œë„¤ë¦­</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/06-enum-annotation">06. ì´ë„˜ íƒ€ì…ê³¼ ì• ë„ˆí…Œì´ì…˜</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/07-lambda-stream">07. ëŒë‹¤ì™€ ìŠ¤íŠ¸ë¦¼</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/08-method">08. ë©”ì†Œë“œ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/09-programming-rule">09. ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë˜ë° ì›ì¹™</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/10-exception">10. ì˜ˆì™¸</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/11-concurrency">11. ë™ì‹œì„±</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/java/effective-java/12-serialize">12. ì§ë ¬í™”</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Kafka</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ì¹´í”„ì¹´ í•µì‹¬ ê°€ì´ë“œ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kafka/kafka-core-guide/03-consumer">03. ì¹´í”„ì¹´ ì»¨ìŠˆë¨¸</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kafka/kafka-core-guide/05-internal">05. ì¹´í”„ì¹´ì˜ ë‚´ë¶€ ë©”ì»¤ë‹ˆì¦˜</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kafka/kafka-core-guide/07-data-pipeline">07. ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/study/docs/kafka/kafka-core-guide/11-streams">11. ìŠ¤íŠ¸ë¦¼ í”„ë¡œì„¸ì‹±</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Spring Security OAuth2 Login</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spring-security-oauth2-client-ê·¸-ê¹Šì€-ì„¸ê³„ë¡œ"></a>Spring Security OAuth2 Client ê·¸ ê¹Šì€ ì„¸ê³„ë¡œ<a class="hash-link" href="#spring-security-oauth2-client-ê·¸-ê¹Šì€-ì„¸ê³„ë¡œ" title="Direct link to heading">#</a></h2><p>íšŒì‚¬ì—ì„œ ì‚¬ë‚´ í† ì´í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•˜ê³  ìˆë‹¤.</p><p>ë‚˜ëŠ” ì—¬ê¸°ì„œ Spring boot + Kotlin + JPA(Query DSL) + Securityì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œ ì¤‘ì— ìˆë‹¤.</p><p>Kakao i ê³„ì • ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ê°œë°œí•˜ê¸° ìœ„í•´ Spring Security OAuth2 Clientë¥¼ ì‚¬ìš© ì¤‘ì¸ë°, ëª‡ ê°€ì§€ ê¶ê¸ˆì¦ì´ ìƒê²¨ ë‚´ë¶€ ì½”ë“œë¥¼ í•œ ë²ˆ ì—´ì–´ë³´ì•˜ë‹¤.</p><p>ì‹œíë¦¬í‹° ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ ê°œë°œìëŠ” ìµœì†Œí•œì˜ ì½”ë“œë§Œ ì‘ì„±í•´ë„ Tokenì„ ì‰½ê²Œ ë°œê¸‰ ë°›ì„ ìˆ˜ ìˆë‹¤.</p><p>ê·¸ë ‡ë‹¤ë³´ë‹ˆ, ë‚´ë¶€ê°€ ì–´ë–»ê²Œ ë™ì‘ë˜ëŠ”ì§€ ëª¨ë¥´ë”ë¼ë„ ì–´ë–»ê²Œë“ (?) ëŒì•„ê°€ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ëŠ” ìˆë‹¤.</p><p>ë‚˜ëŠ” ì´ë ‡ê²Œ ë¸”ë™ë°•ìŠ¤ë¡œ ê°œë°œí•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ì§€ ì•Šì•„ì„œ, ë‚´ê°€ ì°¾ì•„ë³¸ ë‚´ìš©ë“¤ì„ ì •ë¦¬í•´ë‘ê³ ì í•œë‹¤.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="security-í´ë˜ìŠ¤-ì†Œê°œ"></a>Security í´ë˜ìŠ¤ ì†Œê°œ<a class="hash-link" href="#security-í´ë˜ìŠ¤-ì†Œê°œ" title="Direct link to heading">#</a></h2><ul><li><p>ê°œë°œì— ì‚¬ìš©í–ˆë˜ í´ë˜ìŠ¤ë“¤ì„ ê°„ëµíˆ ì •ë¦¬í•´ë³´ì•˜ë‹¤.</p></li><li><p>í–¥í›„ TokenStoreë¼ë˜ì§€ ë” ì¶”ê°€ëœë‹¤ë©´ ë³¸ë¬¸ì—ë„ ì¶”ê°€í•´ë†“ì„ ìƒê°ì´ë‹¤.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="websecurityconfigureradapter"></a>WebSecurityConfigurerAdapter<a class="hash-link" href="#websecurityconfigureradapter" title="Direct link to heading">#</a></h3><ul><li><p>ì‹œíë¦¬í‹°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ Filter Chainë“¤ì´ ë“±ë¡ë˜ì–´ìˆê³  ê·¸ ì²´ì¸ë“¤ì„ ê±°ì¹˜ë©´ì„œ ì¸ì¦ ê³¼ì •ì„ ê±°ì¹˜ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤.</p></li><li><p><strong>WebSecurityConfigurerAdapter</strong>ëŠ” ì´ Security Filter Chainì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¤ì •í•˜ëŠ” ì„¤ì • í´ë˜ìŠ¤ì´ë‹¤.</p></li><li><p>ì´ ì„¤ì •ì´ë¼ í•¨ì€, Security Filter Chainì— ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì •ëœ ì„¤ì • ê°’ì„ ì˜ë¯¸í•œë‹¤.</p></li><li><p>ê°€ë ¹ Authorization Serverì—ì„œ ì½”ë“œë¥¼ ë°›ì•„ì„œ ë˜ëŒì•„ì˜¬ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œê°€ ëŒ€í‘œì ì¸ ì˜ˆì´ë‹¤.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="oauth2authorizationrequestresolver"></a>OAuth2AuthorizationRequestResolver<a class="hash-link" href="#oauth2authorizationrequestresolver" title="Direct link to heading">#</a></h3><ul><li><p><strong>OAuth2AuthorizationRequestRedirectFilter</strong>ì—ì„œ ë™ì‘í•˜ëŠ” í´ë˜ìŠ¤ë¡œ, <strong>OAuth2AuthorizationRequest</strong>ë¥¼ ë¦¬ì¡¸ë¸Œí•œë‹¤.</p></li><li><p>ë™ì‘ì€, Authorization Serverì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë¦¬ë‹¤ì´ë ‰íŠ¸í•´ì„œ ì¸ê°€ ì½”ë“œ ë¶€ì—¬ í”Œë¡œìš°ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•œ <strong>OAuth2AuthorizationRequest</strong>ë¥¼ ë¦¬ì¡¸ë¸Œí•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•œë‹¤.</p></li><li><p>pathê°€ <strong>/oatuh2/authorization/{registrationId}</strong>ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ë¥¼ ë¹„êµí•´ì„œ ì¼ì¹˜í•˜ëŠ” ê²½ìš° <strong>registrationId</strong>ë¥¼ ì¶”ì¶œí•˜ê³  ì´ë¥¼ ì‚¬ìš©í•´ ClientRegistrationì„ ê°€ì ¸ì™€ <strong>OAuth2AuthorizationRequest</strong>ë¥¼ ë¹Œë“œí•œë‹¤.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="oauth2userservice"></a>OAuth2UserService<a class="hash-link" href="#oauth2userservice" title="Direct link to heading">#</a></h3><ul><li><p>UserInfo ì—”ë“œí¬ì´ëŠ©ì—ì„œ ìµœì¢… ì‚¬ìš©ìì˜ ì†ì„±ì„ ê°€ì ¸ì˜¤ë©°, OAuth2 íƒ€ì…ì˜ AuthenticatedPrincipalì„ ë¦¬í„´í•œë‹¤.</p></li><li><p>ì´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ loadUser ë©”ì†Œë“œë¥¼ ì¬ì •ì˜í•˜ì—¬ ì§ì ‘ Authorization Serverë¡œ ìœ ì € ì •ë³´ë¥¼ ì¡°íšŒ, ì €ì¥í•˜ê³  <strong>UserAttribute</strong> ì •ë³´ë¥¼ ë§Œë“œëŠ” ì‘ì—…ì„ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆë‹¤.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ë‚´ë¶€-êµ¬ì¡°ì˜-íë¦„"></a>ë‚´ë¶€ êµ¬ì¡°ì˜ íë¦„<a class="hash-link" href="#ë‚´ë¶€-êµ¬ì¡°ì˜-íë¦„" title="Direct link to heading">#</a></h2><ul><li><p>Securityë¥¼ ê°œë°œí•˜ë©´ì„œ ë‚´ë¶€ í•„í„°ê°€ ì–´ë–¤ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ ê¶ê¸ˆí•´ì„œ ì½”ë“œë¥¼ ëœ¯ì–´ë³´ì•˜ë‹¤.</p></li><li><p>SecurityëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ìœ¼ë¡œ í† í°ì„ ë°œê¸‰ë°›ëŠ”ë‹¤.</p></li></ul><ol><li><p>(Authorization Code Grantì˜ ê²½ìš°) Authorizationë¡œ ì¸ì¦ ì½”ë“œ ìš”ì²­ (ë³´í†µ í•´ë‹¹ Autohrization Serverì˜ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ Redirect ëœë‹¤.)</p></li><li><p>Redirectë¥¼ ë°›ì€ í´ë¼ì´ì–¸íŠ¸(ë³´í†µ Authorization Serverì—ì„œ Redirect ì£¼ì†Œë¥¼ ì»¤ìŠ¤í…€í•˜ê²Œ ëª…ì‹œí•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.)ê°€ Authorization ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ Codeë¥¼ ì‚¬ìš©í•´ Authorization Serverë¡œ í† í°ì„ ìš”ì²­í•œë‹¤.</p></li><li><p>ë°›ì•„ì˜¨ í† í°ì„ ì‚¬ìš©í•´ ì¸ì¦ì´ í•„ìš”í•œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚¸ë‹¤.</p></li></ol><p>Securityì—ì„œëŠ” ìœ„ì™€ ê°™ì€ ì¼ë ¨ì˜ ê³¼ì •ì„ ë³„ë„ì˜ ì½”ë“œ êµ¬í˜„ ì—†ì´ ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ ì œê³µí•´ì¤€ë‹¤.</p><p>OAuth2 Client ì„¤ì •ì„ ëë‚¸ ë’¤, ë¸Œë¼ìš°ì €ë¥¼ ì¼œì„œ <code>localhost:8080/oauth2/authorization/{registrationId}</code>ë¥¼ ì…ë ¥í•´ë³´ë©´ ì¸ì¦ì„ ìœ„í•œ í† í°ì„ ë°œê¸‰ë°›ê¸° ìœ„í•œ í”„ë¡œì„¸ìŠ¤ê°€ ì§„í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><p>ì—¬ê¸°ì„œ ë‚˜ëŠ” ë‘ ê°€ì§€ ì˜ë¬¸ì ì´ ìƒê²¼ë‹¤.</p><p><strong>Authorization Code</strong>ë¥¼ ë°œê¸‰ë°›ê¸° ìœ„í•œ RedirectëŠ” ëŒ€ì²´ ì–´ë””ì„œ ì§„í–‰ë˜ëŠ” ê²ƒì´ë©°,</p><p><strong>Token</strong>ì€ ë˜ ì–´ë–»ê²Œ ì–»ì–´ì˜¤ëŠ”ì§€ê°€ ê¶ê¸ˆí–ˆë‹¤. ( ë‚´ë¶€ì ìœ¼ë¡œ RestTemplateì„ ì¨ì„œ í•˜ëŠ”ê±´ì§€? )</p><p>ì¤‘ê°„ ë‹¨ê³„ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œ ìŠ¤í”„ë§ ì½”ë“œë¥¼ ì—´ì–´ë³´ë©´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ì.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="oauth2authorizationrequestredirectfilter"></a>OAuth2AuthorizationRequestRedirectFilter<a class="hash-link" href="#oauth2authorizationrequestredirectfilter" title="Direct link to heading">#</a></h3><ul><li><p>ì´ <strong>OAuth2AuthorizationRequestRedirectFilter</strong>ëŠ” <strong>OncePerRequestFilter</strong>ë¥¼ êµ¬í˜„í•˜ëŠ” í•„í„° í´ë˜ìŠ¤ì´ë‹¤. (OncePerRequestFilterì— ëŒ€í•œ ë‚´ìš©ì€ <a href="https://minkukjo.github.io/framework/2020/12/18/Spring-142/" target="_blank" rel="noopener noreferrer">ì—¬ê¸°</a>ë¥¼ ì°¸ì¡°)</p></li><li><p>ë‚´ë¶€ë¥¼ ê¹Œë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ì¡´ì¬í•œë‹¤.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throws ServletException, IOException {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2AuthorizationRequest authorizationRequest = this.authorizationRequestResolver.resolve(request);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   if (authorizationRequest != null) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.sendRedirectForAuthorization(request, response, authorizationRequest); // Redirect ë˜ëŠ” ë¶€ë¶„</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p>OAuth2AuthorizationRequestResolverì— ì˜í•´ ë¦¬ì¡¸ë¹™ëœ <strong>OAuth2AuthorizationRequest</strong>ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë˜ì ¸ì„œ Authorization Serverë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‹œí‚¨ë‹¤.</p></li><li><p>Redirectëœ ì„œë²„ì—ì„œ ì¸ì¦ì´ ëë‚œ í›„ (ì•„ë§ˆë„ ID,Password ì…ë ¥) í•´ë‹¹ Authorization Serverì˜ OAuth Clientì— ì •ì˜ëœ Redirect Urië¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ê²Œ ëœë‹¤.</p></li><li><p>í•„ìì˜ ê²½ìš° ìš”ì²­ì„ ë³´ëƒˆë˜ ì„œë²„ë¡œ ë‹¤ì‹œ ìš”ì²­ì„ ë°›ê²Œ í–ˆê³ , OAuth2 Securityì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸ ì£¼ì†Œë„ ì»¤ìŠ¤í…€ í•˜ì˜€ë‹¤.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static final String DEFAULT_FILTER_PROCESSES_URI = &quot;/login/oauth2/code/*&quot;; // ê¸°ë³¸ ê°’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>ì½”ë“œê¹Œì§€ ë°œê¸‰ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ë‹¤ìŒì€ í† í°ì„ ë°œê¸‰ë°›ê¸° ìœ„í•œ í•„í„°ë¡œ ì§„ì…í•œë‹¤.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="oauth2loginauthenticationfilter"></a>OAuth2LoginAuthenticationFilter<a class="hash-link" href="#oauth2loginauthenticationfilter" title="Direct link to heading">#</a></h3><ul><li><p>OAuth2LoginAuthenticationFilterì˜ <strong>attemptAuthentication</strong> ë©”ì†Œë“œê°€ í† í°ì„ ë°œê¸‰í•˜ê³  Authentication ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ê°ì²´ì´ë‹¤.</p></li><li><p>ì—¬ê¸°ì„œ <strong>Authentication</strong> ê°ì²´ëŠ” í•œ ë§ˆë””ë¡œ <strong>ì¸ì¦ëœ ì‚¬ìš©ì</strong>ë¥¼ ì˜ë¯¸í•œë‹¤. ë‚´ë¶€ì ìœ¼ë¡œëŠ” principal(ì‚¬ìš©ì ì‹ë³„), credentails(ì£¼ë¡œ ë¹„ë°€ë²ˆí˜¸), authorities(ì‚¬ìš©ìê°€ ë¶€ì—¬ë°›ì€ ê¶Œí•œ)ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°–ëŠ”ë‹¤. (ì˜ˆì‹œë¡œëŠ” roleê³¼ scope)</p></li><li><p>ì•„ë˜ëŠ” ìœ ì € ì¸ì¦ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , í† í°ì„ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ ì „ë¬¸ì´ë‹¤.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throws AuthenticationException {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  MultiValueMap&lt;String, String&gt; params = OAuth2AuthorizationResponseUtils.toMultiMap(request.getParameterMap());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (!OAuth2AuthorizationResponseUtils.isAuthorizationResponse(params)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2Error oauth2Error = new OAuth2Error(OAuth2ErrorCodes.INVALID_REQUEST);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throw new OAuth2AuthenticationException(oauth2Error, oauth2Error.toString());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AuthorizationRequest authorizationRequest = this.authorizationRequestRepository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .removeAuthorizationRequest(request, response);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (authorizationRequest == null) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2Error oauth2Error = new OAuth2Error(AUTHORIZATION_REQUEST_NOT_FOUND_ERROR_CODE);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throw new OAuth2AuthenticationException(oauth2Error, oauth2Error.toString());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  String registrationId = authorizationRequest.getAttribute(OAuth2ParameterNames.REGISTRATION_ID);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ClientRegistration clientRegistration = this.clientRegistrationRepository.findByRegistrationId(registrationId);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (clientRegistration == null) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2Error oauth2Error = new OAuth2Error(CLIENT_REGISTRATION_NOT_FOUND_ERROR_CODE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;Client Registration not found with Id: &quot; + registrationId, null);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throw new OAuth2AuthenticationException(oauth2Error, oauth2Error.toString());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // @formatter:off</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  String redirectUri = UriComponentsBuilder.fromHttpUrl(UrlUtils.buildFullRequestUrl(request))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .replaceQuery(null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .build()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .toUriString();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // @formatter:on</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AuthorizationResponse authorizationResponse = OAuth2AuthorizationResponseUtils.convert(params,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    redirectUri);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Object authenticationDetails = this.authenticationDetailsSource.buildDetails(request);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2LoginAuthenticationToken authenticationRequest = new OAuth2LoginAuthenticationToken(clientRegistration,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    new OAuth2AuthorizationExchange(authorizationRequest, authorizationResponse));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  authenticationRequest.setDetails(authenticationDetails);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2LoginAuthenticationToken authenticationResult = (OAuth2LoginAuthenticationToken) this</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .getAuthenticationManager().authenticate(authenticationRequest);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AuthenticationToken oauth2Authentication = new OAuth2AuthenticationToken(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authenticationResult.getPrincipal(), authenticationResult.getAuthorities(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authenticationResult.getClientRegistration().getRegistrationId());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  oauth2Authentication.setDetails(authenticationDetails);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AuthorizedClient authorizedClient = new OAuth2AuthorizedClient(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authenticationResult.getClientRegistration(), oauth2Authentication.getName(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authenticationResult.getAccessToken(), authenticationResult.getRefreshToken());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  this.authorizedClientRepository.saveAuthorizedClient(authorizedClient, oauth2Authentication, request, response);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return oauth2Authentication;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="í† í°-ë°œê¸‰ì€-ëŒ€ì²´-ì–´ë””ì—ì„œ"></a>í† í° ë°œê¸‰ì€ ëŒ€ì²´ ì–´ë””ì—ì„œ?<a class="hash-link" href="#í† í°-ë°œê¸‰ì€-ëŒ€ì²´-ì–´ë””ì—ì„œ" title="Direct link to heading">#</a></h3><ul><li><p>ì½”ë“œê°€ ê½¤ ê¸¸ê¸°ë„í•˜ê³  ì´ë ‡ê²Œ ë´ì„œëŠ” ë„ë¬´ì§€ ì–´ë””ì—ì„œ í† í°ì„ ë°œê¸‰í•˜ëŠ”ì§€ ì•Œê¸°ê°€ ì–´ë ¤ì› ë‹¤.</p></li><li><p>ë¬´ì‹í•˜ë©´ ì†ë°œì´ ê³ ìƒí•œë‹¤ê³ , ë„ë¬´ì§€ ì•Œ ìˆ˜ê°€ ì—†ê³  ê¶ê¸ˆí•˜ê¸°ëŠ” í•´ì„œ í•˜ë‚˜ í•˜ë‚˜ ë””ë²„ê·¸ë¥¼ ì°ì–´ì„œ í™•ì¸í•´ë³¸ ê²°ê³¼,</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">OAuth2LoginAuthenticationToken authenticationResult = (OAuth2LoginAuthenticationToken) this</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .getAuthenticationManager().authenticate(authenticationRequest);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><strong>AuthenticationManager</strong>ì˜ <strong>authenticate</strong> ë©”ì†Œë“œì—ì„œ Authorizaitonì„ í˜¸ì¶œí•˜ê³ , í† í°ì„ ì–»ì–´ì˜¤ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸í•˜ì˜€ë‹¤.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public Authentication authenticate(Authentication authentication) throws AuthenticationException {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;? extends Authentication&gt; toTest = authentication.getClass();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  AuthenticationException lastException = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  AuthenticationException parentException = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Authentication result = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Authentication parentResult = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  int currentPosition = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  int size = this.providers.size();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  for (AuthenticationProvider provider : getProviders()) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   if (!provider.supports(toTest)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    continue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   if (logger.isTraceEnabled()) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    logger.trace(LogMessage.format(&quot;Authenticating request with %s (%d/%d)&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      provider.getClass().getSimpleName(), ++currentPosition, size));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    result = provider.authenticate(authentication); // ì—¬ê¸°ì„œ í˜¸ì¶œ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (result != null) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     copyDetails(authentication, result);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p><strong>AuthenticationProvider</strong>ì˜ authenticate ë©”ì†Œë“œì˜ êµ¬í˜„ì„ ë³´ë©´ ë‚´ë¶€ì—ì„œ í† í°ì„ ì–»ì–´ì˜¤ëŠ” ê³¼ì •ì´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p></li><li><p><strong>AuthenticationProvider</strong>ëŠ” ì—¬ëŸ¬ êµ¬í˜„ì²´ê°€ ì¡´ì¬í•˜ëŠ”ë°, í† í°ì„ ì–»ëŠ”ë° ì‚¬ìš©í•˜ëŠ” Providerì˜ ì´ë¦„ì€ <strong>OAuth2LoginAuthenticationProvider</strong>ì´ë‹¤.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ìœ ì €-ì¸ì¦-ì •ë³´ë¥¼-ìƒì„±í•˜ëŠ”-ì£¼ì²´-oauth2loginauthenticationprovider"></a>ìœ ì € ì¸ì¦ ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ì£¼ì²´ OAuth2LoginAuthenticationProvider<a class="hash-link" href="#ìœ ì €-ì¸ì¦-ì •ë³´ë¥¼-ìƒì„±í•˜ëŠ”-ì£¼ì²´-oauth2loginauthenticationprovider" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class OAuth2LoginAuthenticationProvider implements AuthenticationProvider {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public Authentication authenticate(Authentication authentication) throws AuthenticationException {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2LoginAuthenticationToken loginAuthenticationToken = (OAuth2LoginAuthenticationToken) authentication;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AuthorizationCodeAuthenticationToken authorizationCodeAuthenticationToken;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   authorizationCodeAuthenticationToken = (OAuth2AuthorizationCodeAuthenticationToken) this.authorizationCodeAuthenticationProvider</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     .authenticate(new OAuth2AuthorizationCodeAuthenticationToken(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       loginAuthenticationToken.getClientRegistration(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       loginAuthenticationToken.getAuthorizationExchange())); // í† í°ì„ ì–»ëŠ” ê³³ì€ ì—¬ê¸°</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        OAuth2User oauth2User = this.userService.loadUser(new OAuth2UserRequest(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    loginAuthenticationToken.getClientRegistration(), accessToken, additionalParameters));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p>ìœ ì € ì¸ì¦ ì •ë³´ì¸ <strong>Authentication</strong> ê°ì²´ë¥¼ ë§Œë“œëŠ” í•µì‹¬ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤ê°€ ë°”ë¡œ <strong>OAuth2LoginAuthenticationProvider</strong>ì´ë‹¤.</p></li><li><p><strong>OAuth2LoginAuthenticationProvider</strong>ì˜ authenticate ë©”ì†Œë“œì— ì˜ ë³´ë©´, í† í° ë°œê¸‰ ì´í›„ <strong>userService</strong>ì˜ <strong>loadUser</strong> ë©”ì†Œë“œë¥¼ í†µí•´ <strong>OAuth2User</strong> ê°ì²´ë¥¼ ì–»ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p></li><li><p><strong>userService</strong>ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìœ ì €ê°€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œë¡œì¨, ë‚˜ ì—­ì‹œ íšë“í•œ í† í°ì„ ì‚¬ìš©í•´ Authorization Serverì— í† í°ì— í•´ë‹¹í•˜ëŠ” ìœ ì € ì •ë³´ë¥¼ ì–»ì–´ì˜¤ëŠ” ë¡œì§ì„ êµ¬í˜„í–ˆì—ˆë‹¤.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="authorizationcode-ë°œê¸‰-ë°©ì‹ì˜-authentication-ì œê³µì-oauth2authorizationcodeauthenticationprovider"></a>AuthorizationCode ë°œê¸‰ ë°©ì‹ì˜ Authentication ì œê³µì OAuth2AuthorizationCodeAuthenticationProvider<a class="hash-link" href="#authorizationcode-ë°œê¸‰-ë°©ì‹ì˜-authentication-ì œê³µì-oauth2authorizationcodeauthenticationprovider" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class OAuth2AuthorizationCodeAuthenticationProvider implements AuthenticationProvider {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public Authentication authenticate(Authentication authentication) throws AuthenticationException {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AccessTokenResponse accessTokenResponse = this.accessTokenResponseClient.getTokenResponse(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    new OAuth2AuthorizationCodeGrantRequest(authorizationCodeAuthentication.getClientRegistration(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      authorizationCodeAuthentication.getAuthorizationExchange()));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p><strong>OAuth2AuthorizationCodeAuthenticationProvider</strong>ëŠ” AuthorizationCode Grant ë°©ì‹ì˜ <strong>Authentication</strong> ê°ì²´ ìƒì„±ì„ ìœ„í•œ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ëŠ” í´ë˜ìŠ¤ì´ë‹¤.</p></li><li><p>ì´ í´ë˜ìŠ¤ì˜ <strong>authenticate</strong> ë©”ì†Œë“œ ë‚´ë¶€ì— <strong>getTokenResponse</strong> ë¼ëŠ” ë©”ì†Œë“œê°€ ìˆë‹¤. ì´ ë©”ì†Œë“œë¥¼ íƒ€ê³  ë“¤ì–´ê°€ë³´ë©´, í† í°ì„ ë°œí–‰í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì¸ <strong>OAuth2AccessTokenResponseClient</strong>ë¥¼ ë§Œë‚  ìˆ˜ ìˆë‹¤.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="oauth2accesstokenresponseclient"></a>OAuth2AccessTokenResponseClient<a class="hash-link" href="#oauth2accesstokenresponseclient" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * A strategy for &amp;quot;exchanging&amp;quot; an authorization grant credential (e.g. an</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Authorization Code) for an access token credential at the Authorization Server&#x27;s Token</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Endpoint.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @author Joe Grandja</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @since 5.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see AbstractOAuth2AuthorizationGrantRequest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see OAuth2AccessTokenResponse</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see AuthorizationGrantType</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see &lt;a target=&quot;_blank&quot; href=&quot;https://tools.ietf.org/html/rfc6749#section-1.3&quot;&gt;Section</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * 1.3 Authorization Grant&lt;/a&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see &lt;a target=&quot;_blank&quot; href=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * &quot;https://tools.ietf.org/html/rfc6749#section-4.1.3&quot;&gt;Section 4.1.3 Access Token Request</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * (Authorization Code Grant)&lt;/a&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see &lt;a target=&quot;_blank&quot; href=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * &quot;https://tools.ietf.org/html/rfc6749#section-4.1.4&quot;&gt;Section 4.1.4 Access Token Response</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * (Authorization Code Grant)&lt;/a&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@FunctionalInterface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public interface OAuth2AccessTokenResponseClient&lt;T extends AbstractOAuth2AuthorizationGrantRequest&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Exchanges the authorization grant credential, provided in the authorization grant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * request, for an access token credential at the Authorization Server&#x27;s Token</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Endpoint.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param authorizationGrantRequest the authorization grant request that contains the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * authorization grant credential</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @return an {@link OAuth2AccessTokenResponse} that contains the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * {@link OAuth2AccessTokenResponse#getAccessToken() access token} credential</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @throws OAuth2AuthorizationException if an error occurs while attempting to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * exchange for the access token credential</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> OAuth2AccessTokenResponse getTokenResponse(T authorizationGrantRequest);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p>ì´ í´ë˜ìŠ¤ì˜ ì£¼ì„ì„ ì½ì–´ë³´ë©´ ì•Œê² ì§€ë§Œ, <strong>Authorization Server</strong>ì˜ í† í° ì—”ë“œí¬ì¸íŠ¸ë¡œ ì—‘ì„¸ìŠ¤ í† í°ì„ ì–»ì–´ì˜¤ê¸° ìœ„í•œ í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.</p></li><li><p>ì´ë ‡ê²Œ ì œë„¤ë¦­ íƒ€ì…ê³¼ ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„í•œ ì´ìœ ëŠ”, OAuth Tokenì˜ token grant typeì´ ì—¬ëŸ¬ ë°©ì‹ì´ ìˆê¸° ë•Œë¬¸ì— ê°ê¸° ë‹¤ë¥¸ ë°©ì‹ì„ ìœ ì—°í•˜ê²Œ ì œê³µí•˜ê¸° ìœ„í•¨ìœ¼ë¡œ ë³´ì¸ë‹¤. (ìŠ¤í”„ë§ì€ ì•„ì£¼ ê°ì²´ì§€í–¥ìŠ¤ëŸ½ê²Œ ì˜ ì„¤ê³„í•œ í”„ë ˆì„ì›Œí¬ ì¤‘ í•˜ë‚˜ì´ë‹¤.)</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="authorizationtoken-grant-ë°©ì‹ì˜-í† í°-ë°œê¸‰-ì£¼ì²´ì¸-defaultauthorizationcodetokenresponseclient"></a>AuthorizationToken Grant ë°©ì‹ì˜ í† í° ë°œê¸‰ ì£¼ì²´ì¸ DefaultAuthorizationCodeTokenResponseClient<a class="hash-link" href="#authorizationtoken-grant-ë°©ì‹ì˜-í† í°-ë°œê¸‰-ì£¼ì²´ì¸-defaultauthorizationcodetokenresponseclient" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public final class DefaultAuthorizationCodeTokenResponseClient</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  implements OAuth2AccessTokenResponseClient&lt;OAuth2AuthorizationCodeGrantRequest&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> private static final String INVALID_TOKEN_RESPONSE_ERROR_CODE = &quot;invalid_token_response&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> private Converter&lt;OAuth2AuthorizationCodeGrantRequest, RequestEntity&lt;?&gt;&gt; requestEntityConverter = new OAuth2AuthorizationCodeGrantRequestEntityConverter();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> private RestOperations restOperations;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public DefaultAuthorizationCodeTokenResponseClient() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  RestTemplate restTemplate = new RestTemplate(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Arrays.asList(new FormHttpMessageConverter(), new OAuth2AccessTokenResponseHttpMessageConverter()));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  restTemplate.setErrorHandler(new OAuth2ErrorResponseErrorHandler());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  this.restOperations = restTemplate;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public OAuth2AccessTokenResponse getTokenResponse(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2AuthorizationCodeGrantRequest authorizationCodeGrantRequest) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Assert.notNull(authorizationCodeGrantRequest, &quot;authorizationCodeGrantRequest cannot be null&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  RequestEntity&lt;?&gt; request = this.requestEntityConverter.convert(authorizationCodeGrantRequest);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ResponseEntity&lt;OAuth2AccessTokenResponse&gt; response = getResponse(request);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OAuth2AccessTokenResponse tokenResponse = response.getBody();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (CollectionUtils.isEmpty(tokenResponse.getAccessToken().getScopes())) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // As per spec, in Section 5.1 Successful Access Token Response</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // https://tools.ietf.org/html/rfc6749#section-5.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // If AccessTokenResponse.scope is empty, then default to the scope</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // originally requested by the client in the Token Request</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // @formatter:off</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   tokenResponse = OAuth2AccessTokenResponse.withResponse(tokenResponse)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     .scopes(authorizationCodeGrantRequest.getClientRegistration().getScopes())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     .build();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // @formatter:on</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return tokenResponse;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> private ResponseEntity&lt;OAuth2AccessTokenResponse&gt; getResponse(RequestEntity&lt;?&gt; request) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   return this.restOperations.exchange(request, OAuth2AccessTokenResponse.class);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  catch (RestClientException ex) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2Error oauth2Error = new OAuth2Error(INVALID_TOKEN_RESPONSE_ERROR_CODE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;An error occurred while attempting to retrieve the OAuth 2.0 Access Token Response: &quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       + ex.getMessage(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     null);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throw new OAuth2AuthorizationException(oauth2Error, ex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Sets the {@link Converter} used for converting the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * {@link OAuth2AuthorizationCodeGrantRequest} to a {@link RequestEntity}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * representation of the OAuth 2.0 Access Token Request.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param requestEntityConverter the {@link Converter} used for converting to a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * {@link RequestEntity} representation of the Access Token Request</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public void setRequestEntityConverter(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Converter&lt;OAuth2AuthorizationCodeGrantRequest, RequestEntity&lt;?&gt;&gt; requestEntityConverter) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Assert.notNull(requestEntityConverter, &quot;requestEntityConverter cannot be null&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  this.requestEntityConverter = requestEntityConverter;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Sets the {@link RestOperations} used when requesting the OAuth 2.0 Access Token</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Response.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * &lt;p&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * &lt;b&gt;NOTE:&lt;/b&gt; At a minimum, the supplied {@code restOperations} must be configured</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * with the following:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * &lt;ol&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * &lt;li&gt;{@link HttpMessageConverter}&#x27;s - {@link FormHttpMessageConverter} and</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * {@link OAuth2AccessTokenResponseHttpMessageConverter}&lt;/li&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * &lt;li&gt;{@link ResponseErrorHandler} - {@link OAuth2ErrorResponseErrorHandler}&lt;/li&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * &lt;/ol&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param restOperations the {@link RestOperations} used when requesting the Access</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Token Response</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public void setRestOperations(RestOperations restOperations) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Assert.notNull(restOperations, &quot;restOperations cannot be null&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  this.restOperations = restOperations;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p>ë“œë””ì–´ ê°ê³ ì˜ ë…¸ë ¥ ëì— Token APIë¥¼ ìš”ì²­í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë‚  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p></li><li><p>ìŠ¤í”„ë§ ì—­ì‹œ ë‚´ë¶€ì ìœ¼ë¡œ í† í° ìš”ì²­ì„ ìœ„í•œ Http Clientë¡œ <strong>RestTemplate</strong>ì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p></li><li><p>ì¬ë°ŒëŠ” ì ì€ RestTemplateì˜ ì¸í„°í˜ì´ìŠ¤ì¸ <strong>RestOperations</strong>ë¥¼ íƒ€ì…ìœ¼ë¡œ ê°–ëŠ”ë°, ì´ëŠ” ì¶”í›„ì— <strong>RestTemplate</strong>ì´ ì•„ë‹Œ ë‹¤ë¥¸ êµ¬í˜„ì²´ë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ <strong>setRestOperations</strong>ë¥¼ í†µí•´ ë‹¤ë¥¸ <strong>HttpClient</strong>ë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ìœ ì—°í•˜ê²Œ ì„¤ê³„í•œ ê²ƒì´ ëˆˆì— ëˆë‹¤. (í¬...!!)</p></li><li><p>ê·¸ë˜ì„œ ì‹¤ì§ˆì ìœ¼ë¡œ Authorizationì˜ í† í° ì—”ë“œí¬ì¸íŠ¸ë¡œ ìš”ì²­ì„ í•˜ëŠ” ì½”ë“œëŠ” ì•„ë˜ì˜ getResponse ë©”ì†Œë“œì´ë‹¤.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> private ResponseEntity&lt;OAuth2AccessTokenResponse&gt; getResponse(RequestEntity&lt;?&gt; request) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   return this.restOperations.exchange(request, OAuth2AccessTokenResponse.class);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  catch (RestClientException ex) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   OAuth2Error oauth2Error = new OAuth2Error(INVALID_TOKEN_RESPONSE_ERROR_CODE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;An error occurred while attempting to retrieve the OAuth 2.0 Access Token Response: &quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       + ex.getMessage(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     null);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   throw new OAuth2AuthorizationException(oauth2Error, ex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p>ì—¬ê¸°ì„œ í•œ ê°€ì§€ ë”, ìŠ¤í”„ë§ì—ì„œ ì´ëŸ¬í•œ ì™¸ë¶€ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ë©”ì†Œë“œë¥¼ ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë½‘ì•„ë‚´ê³ , ì´ë¦„ì„ <strong>getResponse</strong>ë¡œ ì¤€ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p></li><li><p>ë‚˜ê°™ì€ ê²½ìš° ì´ëŸ¬í•œ ì™¸ë¶€ í˜¸ì¶œí•˜ëŠ” ë©”ì†Œë“œì˜ ê²½ìš° <strong>call</strong>, <strong>request</strong>ì™€ ê°™ì´ <strong>&quot;ë‚´ê°€ ë‹¤ë¥¸ ì„œë²„ì— ìš”ì²­ì„ í•œë‹¤&quot;</strong>ë¼ëŠ” ì˜ë¯¸ë¡œ ë©”ì†Œë“œëª…ì„ ì§€ì—ˆëŠ”ë°, ìŠ¤í”„ë§ì˜ ê²½ìš° ê·¸ í–‰ìœ„ê°€ ê²°ê³¼ì ìœ¼ë¡œ <strong>ë¬´ì—‡</strong>ì„ í•˜ê¸° ìœ„í•œ ê²ƒì¸ì§€ì— ëŒ€í•´ì„œë§Œ ë©”ì†Œë“œëª…ì„ ì ì–´ë†“ì•˜ë˜ ì ì´ ì¸ìƒê¹Šì—ˆë‹¤. (ì°¸ê³ í•´ì•¼ê² ë‹¤.)</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ë‚´ë¶€-íƒí—˜-ì†Œê°"></a>ë‚´ë¶€ íƒí—˜ ì†Œê°<a class="hash-link" href="#ë‚´ë¶€-íƒí—˜-ì†Œê°" title="Direct link to heading">#</a></h2><ul><li><p>ê¹Šê³  ê¹Šì€ Spring ë‚´ë¶€ ì½”ë“œë¥¼ êµ¬ê²½í•˜ëŠ” ê²ƒì€ ì¬ë°Œì—ˆë‹¤.</p></li><li><p>ë˜í•œ ìŠ¤í”„ë§ì€ í° í”„ë¡œì íŠ¸ì´ê³  ë§ì€ ê°œë°œìë“¤ì´ ê¸°ì—¬í•´ì„œ ê·¸ëŸ°ì§€ ì½”ë“œê°€ ê°ì²´ì§€í–¥ ì„¤ê³„ë¥¼ ì˜ ì§€í‚¤ê³  ìˆê³ , ê¹”ë”í•˜ê²Œ êµ¬ì„±ë˜ì–´ ìˆì–´ì„œ ì½ê¸°ê°€ ì¢‹ì•˜ë‹¤.</p></li><li><p>ëª¨ë¥´ëŠ”ê±´ ëŒ€ë¶€ë¶„ ë„íë¨¼íŠ¸ì— ë‚´ìš©ì´ ìˆë”ë¼.</p></li><li><p>í•œêµ­ì— ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ê´€í•œ ì±…ì€ ì™œ ì—†ì„ê¹Œ? ì•„ì‰½ë‹¤.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><p><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/" target="_blank" rel="noopener noreferrer">ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ê³µì‹ ë¬¸ì„œ</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/minkukjo/study/edit/master/docs/spring/security/security-flow.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-08-30T01:25:28.000Z" class="lastUpdatedDate_1WI_">8/30/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/study/docs/spring/jpa/kotlin-jpa-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Kotlin JPA ê°œë°œ ê°€ì´ë“œ</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/study/docs/code/refactoring/00-intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">00. ìŠ¤í„°ë”” ì‹œì‘ Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#spring-security-oauth2-client-ê·¸-ê¹Šì€-ì„¸ê³„ë¡œ" class="table-of-contents__link">Spring Security OAuth2 Client ê·¸ ê¹Šì€ ì„¸ê³„ë¡œ</a></li><li><a href="#security-í´ë˜ìŠ¤-ì†Œê°œ" class="table-of-contents__link">Security í´ë˜ìŠ¤ ì†Œê°œ</a><ul><li><a href="#websecurityconfigureradapter" class="table-of-contents__link">WebSecurityConfigurerAdapter</a></li><li><a href="#oauth2authorizationrequestresolver" class="table-of-contents__link">OAuth2AuthorizationRequestResolver</a></li><li><a href="#oauth2userservice" class="table-of-contents__link">OAuth2UserService</a></li></ul></li><li><a href="#ë‚´ë¶€-êµ¬ì¡°ì˜-íë¦„" class="table-of-contents__link">ë‚´ë¶€ êµ¬ì¡°ì˜ íë¦„</a><ul><li><a href="#oauth2authorizationrequestredirectfilter" class="table-of-contents__link">OAuth2AuthorizationRequestRedirectFilter</a></li><li><a href="#oauth2loginauthenticationfilter" class="table-of-contents__link">OAuth2LoginAuthenticationFilter</a></li><li><a href="#í† í°-ë°œê¸‰ì€-ëŒ€ì²´-ì–´ë””ì—ì„œ" class="table-of-contents__link">í† í° ë°œê¸‰ì€ ëŒ€ì²´ ì–´ë””ì—ì„œ?</a></li><li><a href="#ìœ ì €-ì¸ì¦-ì •ë³´ë¥¼-ìƒì„±í•˜ëŠ”-ì£¼ì²´-oauth2loginauthenticationprovider" class="table-of-contents__link">ìœ ì € ì¸ì¦ ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ì£¼ì²´ OAuth2LoginAuthenticationProvider</a></li><li><a href="#authorizationcode-ë°œê¸‰-ë°©ì‹ì˜-authentication-ì œê³µì-oauth2authorizationcodeauthenticationprovider" class="table-of-contents__link">AuthorizationCode ë°œê¸‰ ë°©ì‹ì˜ Authentication ì œê³µì OAuth2AuthorizationCodeAuthenticationProvider</a></li><li><a href="#oauth2accesstokenresponseclient" class="table-of-contents__link">OAuth2AccessTokenResponseClient</a></li><li><a href="#authorizationtoken-grant-ë°©ì‹ì˜-í† í°-ë°œê¸‰-ì£¼ì²´ì¸-defaultauthorizationcodetokenresponseclient" class="table-of-contents__link">AuthorizationToken Grant ë°©ì‹ì˜ í† í° ë°œê¸‰ ì£¼ì²´ì¸ DefaultAuthorizationCodeTokenResponseClient</a></li></ul></li><li><a href="#ë‚´ë¶€-íƒí—˜-ì†Œê°" class="table-of-contents__link">ë‚´ë¶€ íƒí—˜ ì†Œê°</a></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Harry's Study, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/study/assets/js/runtime~main.6e54e51d.js"></script>
<script src="/study/assets/js/main.b6c5c469.js"></script>
</body>
</html>